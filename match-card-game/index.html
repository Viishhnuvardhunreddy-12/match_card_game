<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Quest</title>
    <style>
        :root {
            --primary-color: #4a4e69;
            --secondary-color: #9a8c98;
            --accent-color: #c9ada7;
            --light-color: #f2e9e4;
            --dark-color: #22223b;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-color);
            color: var(--dark-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
        }
        
        h1 {
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .game-container {
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 20px;
            padding: 10px;
            background-color: var(--primary-color);
            color: var(--light-color);
            border-radius: 8px;
        }
        
        .stats {
            display: flex;
            gap: 20px;
        }
        
        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
            perspective: 1000px;
        }
        
        .card {
            width: 100px;
            height: 150px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }
        
        .card.flipped {
            transform: rotateY(180deg);
        }
        
        .card.matched {
            transform: rotateY(180deg);
        }
        
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .card-front {
            background-color: var(--accent-color);
            transform: rotateY(180deg);
        }
        
        .card-back {
            background-color: var(--secondary-color);
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%239a8c98"/><path d="M30,20 L70,20 L70,80 L30,80 Z" fill="%23c9ada7"/><circle cx="50" cy="50" r="15" fill="%234a4e69"/></svg>');
            background-size: cover;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: var(--light-color);
            padding: 30px;
            border-radius: 10px;
            width: 80%;
            max-width: 500px;
            text-align: center;
        }
        
        .modal-title {
            color: var(--primary-color);
            margin-top: 0;
        }
        
        .btn {
            background-color: var(--primary-color);
            color: var(--light-color);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: var(--dark-color);
        }
        
        .story-container {
            background-color: var(--accent-color);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            width: 100%;
        }
        
        .story-title {
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .progress-container {
            width: 100%;
            background-color: var(--secondary-color);
            height: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s;
        }
        
        @media (max-width: 600px) {
            .board {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .card {
                width: 80px;
                height: 120px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Memory Quest</h1>
        <p>Match cards to reveal the story and unlock new abilities!</p>
    </header>
    
    <div class="game-container">
        <div class="progress-container">
            <div class="progress-bar" id="levelProgress"></div>
        </div>
        
        <div class="status-bar">
            <div class="stats">
                <div class="stat">
                    <div>Level</div>
                    <div id="level">1</div>
                </div>
                <div class="stat">
                    <div>Score</div>
                    <div id="score">0</div>
                </div>
                <div class="stat">
                    <div>Coins</div>
                    <div id="coins">0</div>
                </div>
            </div>
            <div>
                <div class="stat">
                    <div>Moves</div>
                    <div id="moves">0</div>
                </div>
            </div>
        </div>
        
        <div class="story-container">
            <div class="story-title">Your Quest Begins...</div>
            <div id="storyContent">Welcome, adventurer! Match the mysterious cards to unlock ancient knowledge and progress on your journey.</div>
        </div>
        
        <div class="board" id="board"></div>
        
        <button class="btn" id="resetBtn">Reset Game</button>
    </div>
    
    <div class="modal" id="levelUpModal">
        <div class="modal-content">
            <h2 class="modal-title">Level Up!</h2>
            <p>Congratulations! You've advanced to level <span id="newLevel">2</span>!</p>
            <p>You've earned <span id="earnedCoins">10</span> coins!</p>
            <p id="unlockedItem"></p>
            <button class="btn" id="continueBtn">Continue Journey</button>
        </div>
    </div>
    
    <div class="modal" id="victoryModal">
        <div class="modal-content">
            <h2 class="modal-title">Level Complete!</h2>
            <p>Great job! You matched all the cards!</p>
            <p>Score: <span id="finalScore">0</span></p>
            <p>Coins earned: <span id="levelCoins">0</span></p>
            <button class="btn" id="nextLevelBtn">Next Level</button>
        </div>
    </div>
    
    <script>
        // Game state
        const gameState = {
            level: 1,
            score: 0,
            coins: 0,
            moves: 0,
            cardsPaired: 0,
            cardsInPlay: 0,
            firstCard: null,
            secondCard: null,
            locked: false,
            xpToNextLevel: 100,
            currentXP: 0
        };
        
        // Card symbols for different levels
        const levelSymbols = [
            // Level 1: Basic symbols
            ['🌟', '🌙', '☀️', '🌈', '⚡', '❄️', '🔥', '🌊'],
            // Level 2: Animals
            ['🐶', '🐱', '🐭', '🐰', '🦊', '🐻', '🐼', '🐨', '🦁', '🐯'],
            // Level 3: Fantasy
            ['🧙‍♂️', '🧝‍♀️', '🧚', '🦄', '🐲', '🏰', '⚔️', '🛡️', '📜', '💎', '👑', '🔮']
        ];
        
        // Story elements
        const storyElements = [
            "Welcome, adventurer! Match the mysterious cards to unlock ancient knowledge and progress on your journey.",
            "As you match the celestial symbols, a map begins to form in your mind. You sense there's more to discover in this magical realm.",
            "The animals of the enchanted forest have appeared on your cards! They seem to be guiding you toward something important.",
            "Mythical creatures and magical items now reveal themselves to you. You're getting closer to uncovering the great secret!"
        ];
        
        // Special abilities that can be unlocked
        const specialAbilities = [
            { name: "Peek", description: "Reveal a card for 1 second", cost: 50 },
            { name: "Second Chance", description: "Retry after a mismatch once per level", cost: 100 },
            { name: "Time Freeze", description: "Pause the timer for 10 seconds", cost: 150 }
        ];
        
        // Initialize the game
        function initGame() {
            updateStats();
            createBoard();
            document.getElementById('resetBtn').addEventListener('click', resetGame);
            document.getElementById('continueBtn').addEventListener('click', closeModal);
            document.getElementById('nextLevelBtn').addEventListener('click', nextLevel);
        }
        
        // Create the game board
        function createBoard() {
            const board = document.getElementById('board');
            board.innerHTML = '';
            
            // Determine number of pairs based on level
            const numPairs = Math.min(Math.floor(gameState.level * 4), levelSymbols[Math.min(gameState.level - 1, levelSymbols.length - 1)].length);
            
            // Get symbols for this level
            const levelIndex = Math.min(gameState.level - 1, levelSymbols.length - 1);
            let symbols = levelSymbols[levelIndex].slice(0, numPairs);
            
            // Create pairs of cards
            let cards = [...symbols, ...symbols];
            gameState.cardsInPlay = cards.length;
            
            // Shuffle cards
            cards = shuffleArray(cards);
            
            // Adjust grid columns based on number of cards
            if (cards.length <= 12) {
                board.style.gridTemplateColumns = 'repeat(4, 1fr)';
            } else if (cards.length <= 20) {
                board.style.gridTemplateColumns = 'repeat(5, 1fr)';
            } else {
                board.style.gridTemplateColumns = 'repeat(6, 1fr)';
            }
            
            // Create card elements
            cards.forEach((symbol, index) => {
                const card = document.createElement('div');
                card.classList.add('card');
                card.dataset.symbol = symbol;
                card.dataset.index = index;
                
                const cardBack = document.createElement('div');
                cardBack.classList.add('card-face', 'card-back');
                
                const cardFront = document.createElement('div');
                cardFront.classList.add('card-face', 'card-front');
                cardFront.textContent = symbol;
                
                card.appendChild(cardFront);
                card.appendChild(cardBack);
                
                card.addEventListener('click', () => flipCard(card));
                
                board.appendChild(card);
            });
            
            // Update story content
            document.getElementById('storyContent').textContent = storyElements[Math.min(gameState.level - 1, storyElements.length - 1)];
        }
        
        // Flip a card
        function flipCard(card) {
            // Prevent clicking if board is locked or card is already flipped/matched
            if (gameState.locked || card.classList.contains('flipped') || card.classList.contains('matched')) {
                return;
            }
            
            // Flip the card
            card.classList.add('flipped');
            
            // Handle first and second card selection
            if (!gameState.firstCard) {
                // First card selected
                gameState.firstCard = card;
            } else if (!gameState.secondCard) {
                // Second card selected
                gameState.secondCard = card;
                gameState.moves++;
                updateStats();
                
                // Check for match
                checkForMatch();
            }
        }
        
        // Check if the two flipped cards match
        function checkForMatch() {
            gameState.locked = true;
            
            const isMatch = gameState.firstCard.dataset.symbol === gameState.secondCard.dataset.symbol;
            
            if (isMatch) {
                // Cards match
                cardMatched();
            } else {
                // Cards don't match
                setTimeout(() => {
                    gameState.firstCard.classList.remove('flipped');
                    gameState.secondCard.classList.remove('flipped');
                    resetCardSelection();
                }, 1000);
            }
        }
        
        // Handle matched cards
        function cardMatched() {
            gameState.firstCard.classList.add('matched');
            gameState.secondCard.classList.add('matched');
            
            // Remove click event from matched cards
            gameState.firstCard.removeEventListener('click', flipCard);
            gameState.secondCard.removeEventListener('click', flipCard);
            
            // Update score and coins
            const scoreGain = 10 * gameState.level;
            const coinGain = 1 * gameState.level;
            
            gameState.score += scoreGain;
            gameState.coins += coinGain;
            gameState.cardsPaired += 2;
            
            // Add XP
            addExperience(20);
            
            // Check if level is complete
            if (gameState.cardsPaired === gameState.cardsInPlay) {
                setTimeout(() => {
                    showVictoryModal();
                }, 500);
            }
            
            resetCardSelection();
            updateStats();
        }
        
        // Reset card selection after checking for match
        function resetCardSelection() {
            gameState.firstCard = null;
            gameState.secondCard = null;
            gameState.locked = false;
        }
        
        // Show victory modal when level is complete
        function showVictoryModal() {
            const bonusCoins = gameState.level * 5;
            gameState.coins += bonusCoins;
            updateStats();
            
            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('levelCoins').textContent = bonusCoins;
            
            document.getElementById('victoryModal').style.display = 'flex';
        }
        
        // Proceed to next level
        function nextLevel() {
            gameState.level++;
            gameState.cardsPaired = 0;
            
            document.getElementById('victoryModal').style.display = 'none';
            createBoard();
            
            // Show level up modal
            document.getElementById('newLevel').textContent = gameState.level;
            document.getElementById('earnedCoins').textContent = gameState.level * 5;
            
            // Check if player unlocked anything
            if (gameState.level === 2) {
                document.getElementById('unlockedItem').textContent = 'You\'ve unlocked new card designs!';
            } else if (gameState.level === 3) {
                document.getElementById('unlockedItem').textContent = 'You\'ve unlocked a peek ability! (Coming soon)';
            } else {
                document.getElementById('unlockedItem').textContent = '';
            }
            
            document.getElementById('levelUpModal').style.display = 'flex';
            
            // Update story and visuals
            updateStats();
        }
        
        // Close modal
        function closeModal() {
            document.getElementById('levelUpModal').style.display = 'none';
        }
        
        // Reset the game
        function resetGame() {
            gameState.level = 1;
            gameState.score = 0;
            gameState.coins = 0;
            gameState.moves = 0;
            gameState.cardsPaired = 0;
            gameState.currentXP = 0;
            
            createBoard();
            updateStats();
        }
        
        // Add experience points
        function addExperience(xp) {
            gameState.currentXP += xp;
            
            // Check for level up (currently disabled)
            /*if (gameState.currentXP >= gameState.xpToNextLevel) {
                gameState.currentXP -= gameState.xpToNextLevel;
                gameState.xpToNextLevel = Math.floor(gameState.xpToNextLevel * 1.5);
                // Show level up modal
            }*/
            
            // Update progress bar
            const progressPercentage = (gameState.currentXP / gameState.xpToNextLevel) * 100;
            document.getElementById('levelProgress').style.width = `${progressPercentage}%`;
        }
        
        // Update game statistics display
        function updateStats() {
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('coins').textContent = gameState.coins;
            document.getElementById('moves').textContent = gameState.moves;
        }
        
        // Shuffle array (Fisher-Yates algorithm)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // Initialize game when DOM is loaded
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>